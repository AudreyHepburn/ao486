185c185
<   mov ax,#0x21 //ao #?1
---
>   mov ax,#?1
1540,1545c1540,1541
<   if((action & BIOS_PRINTF_DEBUG) || (action & BIOS_PRINTF_INFO) || (action & BIOS_PRINTF_SCREEN)) {
<     while(inw(DEBUG_PORT+6) == 0) { ; }
<   }
<   if (action & BIOS_PRINTF_DEBUG)  outb(DEBUG_PORT, c);
<   if (action & BIOS_PRINTF_INFO)   outb(INFO_PORT, c);
<   if (action & BIOS_PRINTF_SCREEN) outb(INFO_PORT, c);
---
>   if (action & BIOS_PRINTF_DEBUG) outb(DEBUG_PORT, c);
>   if (action & BIOS_PRINTF_INFO) outb(INFO_PORT, c);
1709c1705
<     outb(PANIC_PORT2, '&'); //ao 0x00
---
>     outb(PANIC_PORT2, 0x00);
2516,2518c2512
< //AO modif
<   Bit16u time=0,last=0;
< //AO modif
---
>   Bit32u time=0,last=0;
2539,2541c2533
< //AO modif
<     if (time>>8 != last) // mod 2048 each 16 ms
< //AO modif
---
>     if (time>>16 != last) // mod 2048 each 16 ms
2543,2548c2535,2536
< //AO modif
<       last = time >>8;
< //AO modif
< //AO modif
<       BX_DEBUG_ATA("await_ide: (TIMEOUT,BSY,!BSY,!BSY_DRQ,!BSY_!DRQ,!BSY_RDY) %d time= %ld timeout= %d, status= %x\n",when_done,time>>3, timeout, status);
< //AO modif
---
>       last = time >>16;
>       BX_DEBUG_ATA("await_ide: (TIMEOUT,BSY,!BSY,!BSY_DRQ,!BSY_!DRQ,!BSY_RDY) %d time= %ld timeout= %d\n",when_done,time>>11, timeout);
2552,2554c2540
< //AO modif
<       BX_DEBUG_ATA("await_ide: ERROR (TIMEOUT,BSY,!BSY,!BSY_DRQ,!BSY_!DRQ,!BSY_RDY) %d time= %ld timeout= %d\n",when_done,time>>3, timeout);
< //AO modif
---
>       BX_DEBUG_ATA("await_ide: ERROR (TIMEOUT,BSY,!BSY,!BSY_DRQ,!BSY_!DRQ,!BSY_RDY) %d time= %ld timeout= %d\n",when_done,time>>11, timeout);
2557,2559c2543
< //AO modif
<     if ((timeout == 0) || ((time>>3) > timeout)) break;
< //AO modif
---
>     if ((timeout == 0) || ((time>>11) > timeout)) break;
3118,3121c3102
< //AO modification start
< //modif    if(ioflag == 0) await_ide(NOT_BSY, iobase1, IDE_TIMEOUT);
<     await_ide(NOT_BSY, iobase1, IDE_TIMEOUT);
< //AO modification end
---
>     if(ioflag == 0) await_ide(NOT_BSY, iobase1, IDE_TIMEOUT);
